<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title xmlns:ng="http://docbook.org/docbook-ng">visit-each</title><link rel="stylesheet" type="text/css" href="schematron4.css"><meta xmlns:ng="http://docbook.org/docbook-ng" name="generator" content="DocBook XSL Stylesheets V1.79.2"><link rel="home" href="index.html" title="What's New In Schematron 4"><link rel="up" href="pt01.html" title="New attributes"><link rel="prev" href="ch04.html" title="severity"><link rel="next" href="ch06.html" title="when"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center"><code class="sgmltag-attribute">visit-each</code></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04.html">Prev</a>&nbsp;</td><th width="60%" align="center">New attributes</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch06.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="d5e235"></a><code class="sgmltag-attribute">visit-each</code></h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="ch05.html#d5e252">Declaration</a></span></dt><dt><span class="section"><a href="ch05.html#d5e256">Related GitHub issue(s)</a></span></dt><dt><span class="section"><a href="ch05.html#d5e260">Sample usage</a></span></dt><dt><span class="section"><a href="ch05.html#d5e272">Commentary</a></span></dt></dl></div><div class="itemizedlist"><p class="title"><b>Element context(s)</b></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="sgmltag-element">rule</code></p></li></ul></div><p>This attribute is <span class="bold"><strong>optional</strong></span> and selects items matched by a <code class="literal">rule</code> context for further evaluation.</p><div class="blockquote"><blockquote class="blockquote"><div class="blockquote-title"><p><b>Clause 5.5.21 (<code class="literal">visit-each</code> attribute)</b></p></div><p>The <code class="literal">visit-each</code> attribute contains an expression which selects a sequence of items for further evaluation.</p><p>The expression is evaluated against each item resulting from evaluation of the rule's context expression. If this sequence is non-empty, it becomes the context against which assertions are evaluated, in place of the rule's context. If it is empty, the rule is still considered to have fired.</p></blockquote></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e252"></a>Declaration</h2></div></div></div><pre class="programlisting">element rule {
        attribute flag { flagValue }?,
        rich,
        linkable,
        (foreign
         &amp; inclusion*
         &amp; ((attribute context { pathValue },
               <span class="highlight">attribute visit-each { pathValue }?</span>,
               attribute id { xsd:ID }?,
               attribute abstract { "false" }?,
               title?,
               let*,
               (assert | report | extends | p)+)))
    }</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e256"></a>Related GitHub issue(s)</h2></div></div></div><p><a class="link" href="https://github.com/Schematron/schematron-enhancement-proposals/issues/75" target="_top">Checking for substrings of the node values</a></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e260"></a>Sample usage</h2></div></div></div><div class="example"><a name="d5e262"></a><p class="title"><b>Example&nbsp;10.&nbsp;<code class="literal">visit-each</code> attribute</b></p><div class="example-contents"><p>Validating this document:</p><pre class="programlisting"><strong class="hl-tag" style="color: #000096">&lt;foo&gt;</strong>foo bar blort foo bar<strong class="hl-tag" style="color: #000096">&lt;/foo&gt;</strong></pre><p>against a schema containing this rule:</p><pre class="programlisting"><strong class="hl-tag" style="color: #000096">&lt;sch:rule</strong> <span class="hl-attribute" style="color: #F5844C">context</span>=<span class="hl-value" style="color: #993300">'foo'</span> <span class="hl-attribute" style="color: #F5844C">visit-each</span>=<span class="hl-value" style="color: #993300">'fn:analyze-string(., "foo")/fn:match'</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;sch:report</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">'.'</span><strong class="hl-tag" style="color: #000096">&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;sch:name/&gt;</strong> at index <strong class="hl-tag" style="color: #000096">&lt;sch:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">'string-length(string-join(preceding-sibling::fn:*))+1'</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/sch:report&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/sch:rule&gt;</strong></pre><p>produces SVRL output containing:</p><pre class="programlisting"><strong class="hl-tag" style="color: #000096">&lt;svrl:fired-rule</strong> <span class="hl-attribute" style="color: #F5844C">context</span>=<span class="hl-value" style="color: #993300">"/foo"</span> <span class="highlight">visit-each="analyze-string(., "foo")/fn:match"</span>/&gt;
<strong class="hl-tag" style="color: #000096">&lt;successful-report</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://purl.oclc.org/dsdl/svrl"</span> <span class="hl-attribute" style="color: #F5844C">location</span>=<span class="hl-value" style="color: #993300">"Q{http://www.w3.org/2005/xpath-functions}root()/Q{http://www.w3.org/2005/xpath-functions}match[1]"</span> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"."</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;svrl:text&gt;</strong>foo at index 1<strong class="hl-tag" style="color: #000096">&lt;/svrl:text&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/successful-report&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;successful-report</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://purl.oclc.org/dsdl/svrl"</span> <span class="hl-attribute" style="color: #F5844C">location</span>=<span class="hl-value" style="color: #993300">"Q{http://www.w3.org/2005/xpath-functions}root()/Q{http://www.w3.org/2005/xpath-functions}match[2]"</span> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"."</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;svrl:text&gt;</strong>foo at index 15<strong class="hl-tag" style="color: #000096">&lt;/svrl:text&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/successful-report&gt;</strong></pre></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e272"></a>Commentary</h2></div></div></div><p>This attribute effectively allows the schema author to iterate over the sequence of items returned. While the rule context expression in the example above can (depending on the query language binding) be re-written as</p><pre class="programlisting">/foo/analyze-string(., "foo")/fn:match</pre><p>and produce the same result, <code class="sgmltag-attribute">visit-each</code> enables the expression to be decomposed for clarity.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="pt01.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch06.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"><code class="sgmltag-attribute">severity</code>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;<code class="sgmltag-attribute">when</code></td></tr></table></div></body></html>